
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <title>UDP/Datagram · fe-books</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.0">
        <meta name="author" content="laomu1988@qq.com">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
        

    

    
        
    

        

    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="url.html" />
    
    
    <link rel="prev" href="tty.html" />
    

<link rel="stylesheet" href="/fe-books/server/index.css"/>

    </head>
    <body>
        
<script src="/fe-books/server/vue.min.js"></script>
<nav class="fe-menu">
	<ul>
		<li><a href="/fe-books/books/assist/index.html">说明</a></li>
		<li><a href="/fe-books/books/react/index.html">react</a></li>
		<li>
			<a href="/fe-books/books/vue/index.html">vue.js</a>
			<ul class="sub">
				<li><a href="/fe-books/books/vue-router/index.html">vue-router</a></li>
			</ul>
		</li>
		<li>
			<a href="/fe-books/books/node/documentation.html">node</a>
			<ul class="sub">
				<li><a href="/fe-books/books/koa/index.html">koa</a></li>
			</ul>
		</li>
		<li><a href="/fe-books/books/es6/index.html">es6入门</a></li>
		<li>
			<a href="/fe-books/books/tools/index.html">工具</a>
			<ul class="sub">
				<li><a href="/fe-books/books/tools/git.html">git</a></li>
				<li><a href="/fe-books/books/tools/vim.html">vim</a></li>
				<li><a href="/fe-books/books/fis3/index.html">fis3</a></li>
			</ul>
		</li>
		<li class="menu-last"></li>
	</ul>
</nav>

<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="documentation.html">
            
                <a href="documentation.html">
            
                    
                    About these Docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="synopsis.html">
            
                <a href="synopsis.html">
            
                    
                    Usage & Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="assert.html">
            
                <a href="assert.html">
            
                    
                    Assertion Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="buffer.html">
            
                <a href="buffer.html">
            
                    
                    Buffer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="addons.html">
            
                <a href="addons.html">
            
                    
                    C/C++ Addons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="child_process.html">
            
                <a href="child_process.html">
            
                    
                    Child Processes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="cluster.html">
            
                <a href="cluster.html">
            
                    
                    Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="cli.html">
            
                <a href="cli.html">
            
                    
                    Command Line Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="console.html">
            
                <a href="console.html">
            
                    
                    Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="crypto.html">
            
                <a href="crypto.html">
            
                    
                    Crypto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="debugger.html">
            
                <a href="debugger.html">
            
                    
                    Debugger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="dns.html">
            
                <a href="dns.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="domain.html">
            
                <a href="domain.html">
            
                    
                    Domain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="errors.html">
            
                <a href="errors.html">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="fs.html">
            
                <a href="fs.html">
            
                    
                    File System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="globals.html">
            
                <a href="globals.html">
            
                    
                    Globals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="http.html">
            
                <a href="http.html">
            
                    
                    HTTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="https.html">
            
                <a href="https.html">
            
                    
                    HTTPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="modules.html">
            
                <a href="modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="net.html">
            
                <a href="net.html">
            
                    
                    Net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="os.html">
            
                <a href="os.html">
            
                    
                    OS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="path.html">
            
                <a href="path.html">
            
                    
                    Path
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25" data-path="process.html">
            
                <a href="process.html">
            
                    
                    Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26" data-path="punycode.html">
            
                <a href="punycode.html">
            
                    
                    Punycode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27" data-path="querystring.html">
            
                <a href="querystring.html">
            
                    
                    Query Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28" data-path="readline.html">
            
                <a href="readline.html">
            
                    
                    Readline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.29" data-path="repl.html">
            
                <a href="repl.html">
            
                    
                    REPL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30" data-path="stream.html">
            
                <a href="stream.html">
            
                    
                    Stream
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.31" data-path="string_decoder.html">
            
                <a href="string_decoder.html">
            
                    
                    String Decoder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.32" data-path="timers.html">
            
                <a href="timers.html">
            
                    
                    Timers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33" data-path="tls.html">
            
                <a href="tls.html">
            
                    
                    TLS/SSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34" data-path="tty.html">
            
                <a href="tty.html">
            
                    
                    TTY
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.35" data-path="dgram.html">
            
                <a href="dgram.html">
            
                    
                    UDP/Datagram
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.36" data-path="url.html">
            
                <a href="url.html">
            
                    
                    URL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37" data-path="util.html">
            
                <a href="util.html">
            
                    
                    Utilities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.38" data-path="v8.html">
            
                <a href="v8.html">
            
                    
                    V8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.39" data-path="vm.html">
            
                <a href="vm.html">
            
                    
                    VM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.40" data-path="zlib.html">
            
                <a href="zlib.html">
            
                    
                    ZLIB
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://github.com/nodejs/node">
            
                    
                    GitHub Repo & Issue Tracker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <a target="_blank" href="http://groups.google.com/group/nodejs">
            
                    
                    Mailing List
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >UDP/Datagram</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="udp--datagram-sockets">UDP / Datagram Sockets</h1>
<pre><code>Stability: 2 - Stable
</code></pre><!-- name=dgram -->
<p>The <code>dgram</code> module provides an implementation of UDP Datagram sockets.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> dgram = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;dgram&apos;</span>);
<span class="hljs-keyword">const</span> server = dgram.createSocket(<span class="hljs-string">&apos;udp4&apos;</span>);

server.on(<span class="hljs-string">&apos;error&apos;</span>, (err) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`server error:\n<span class="hljs-subst">${err.stack}</span>`</span>);
  server.close();
});

server.on(<span class="hljs-string">&apos;message&apos;</span>, (msg, rinfo) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`server got: <span class="hljs-subst">${msg}</span> from <span class="hljs-subst">${rinfo.address}</span>:<span class="hljs-subst">${rinfo.port}</span>`</span>);
});

server.on(<span class="hljs-string">&apos;listening&apos;</span>, () =&gt; {
  <span class="hljs-keyword">var</span> address = server.address();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`server listening <span class="hljs-subst">${address.address}</span>:<span class="hljs-subst">${address.port}</span>`</span>);
});

server.bind(<span class="hljs-number">41234</span>);
<span class="hljs-comment">// server listening 0.0.0.0:41234</span>
</code></pre>
<h2 id="class-dgramsocket">Class: dgram.Socket</h2>
<p>The <code>dgram.Socket</code> object is an <a href="events.html"><code>EventEmitter</code></a> that encapsulates the
datagram functionality.</p>
<p>New instances of <code>dgram.Socket</code> are created using <a href="#dgram_dgram_createsocket_options_callback"><code>dgram.createSocket()</code></a>.
The <code>new</code> keyword is not to be used to create <code>dgram.Socket</code> instances.</p>
<h3 id="event-close">Event: &apos;close&apos;</h3>
<p>The <code>&apos;close&apos;</code> event is emitted after a socket is closed with <a href="#dgram_socket_close_callback"><code>close()</code></a>.
Once triggered, no new <code>&apos;message&apos;</code> events will be emitted on this socket.</p>
<h3 id="event-error">Event: &apos;error&apos;</h3>
<ul>
<li><code>exception</code> {Error}</li>
</ul>
<p>The <code>&apos;error&apos;</code> event is emitted whenever any error occurs. The event handler
function is passed a single Error object.</p>
<h3 id="event-listening">Event: &apos;listening&apos;</h3>
<p>The <code>&apos;listening&apos;</code> event is emitted whenever a socket begins listening for
datagram messages. This occurs as soon as UDP sockets are created.</p>
<h3 id="event-message">Event: &apos;message&apos;</h3>
<ul>
<li><code>msg</code> {Buffer} - The message</li>
<li><code>rinfo</code> {Object} - Remote address information</li>
</ul>
<p>The <code>&apos;message&apos;</code> event is emitted when a new datagram is available on a socket.
The event handler function is passed two arguments: <code>msg</code> and <code>rinfo</code>. The
<code>msg</code> argument is a <a href="buffer.html"><code>Buffer</code></a> and <code>rinfo</code> is an object with the sender&apos;s
address information provided by the <code>address</code>, <code>family</code> and <code>port</code> properties:</p>
<pre><code class="lang-js">socket.on(<span class="hljs-string">&apos;message&apos;</span>, (msg, rinfo) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Received %d bytes from %s:%d\n&apos;</span>,
              msg.length, rinfo.address, rinfo.port);
});
</code></pre>
<h3 id="socketaddmembershipmulticastaddress-multicastinterface">socket.addMembership(multicastAddress[, multicastInterface])</h3>
<!-- YAML
added: v0.6.9
-->
<ul>
<li><code>multicastAddress</code> {String}</li>
<li><code>multicastInterface</code> {String}, Optional</li>
</ul>
<p>Tells the kernel to join a multicast group at the given <code>multicastAddress</code> and
<code>multicastInterface</code> using the <code>IP_ADD_MEMBERSHIP</code> socket option. If the
<code>multicastInterface</code> argument is not specified, the operating system will choose
one interface and will add membership to it. To add membership to every
available interface, call <code>addMembership</code> multiple times, once per interface.</p>
<h3 id="socketaddress">socket.address()</h3>
<p>Returns an object containing the address information for a socket.
For UDP sockets, this object will contain <code>address</code>, <code>family</code> and <code>port</code>
properties.</p>
<h3 id="socketbindport-address-callback">socket.bind([port][, address][, callback])</h3>
<ul>
<li><code>port</code> {Number} - Integer, Optional</li>
<li><code>address</code> {String}, Optional</li>
<li><code>callback</code> {Function} with no parameters, Optional. Called when
binding is complete.</li>
</ul>
<p>For UDP sockets, causes the <code>dgram.Socket</code> to listen for datagram messages on a
named <code>port</code> and optional <code>address</code>. If <code>port</code> is not specified, the operating
system will attempt to bind to a random port. If <code>address</code> is not specified,
the operating system will attempt to listen on all addresses.  Once binding is
complete, a <code>&apos;listening&apos;</code> event is emitted and the optional <code>callback</code> function
is called.</p>
<p>Note that specifying both a <code>&apos;listening&apos;</code> event listener and passing a
<code>callback</code> to the <code>socket.bind()</code> method is not harmful but not very
useful.</p>
<p>A bound datagram socket keeps the Node.js process running to receive
datagram messages.</p>
<p>If binding fails, an <code>&apos;error&apos;</code> event is generated. In rare case (e.g.
attempting to bind with a closed socket), an <a href="errors.html#errors_class_error"><code>Error</code></a> may be thrown.</p>
<p>Example of a UDP server listening on port 41234:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> dgram = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;dgram&apos;</span>);
<span class="hljs-keyword">const</span> server = dgram.createSocket(<span class="hljs-string">&apos;udp4&apos;</span>);

server.on(<span class="hljs-string">&apos;error&apos;</span>, (err) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`server error:\n<span class="hljs-subst">${err.stack}</span>`</span>);
  server.close();
});

server.on(<span class="hljs-string">&apos;message&apos;</span>, (msg, rinfo) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`server got: <span class="hljs-subst">${msg}</span> from <span class="hljs-subst">${rinfo.address}</span>:<span class="hljs-subst">${rinfo.port}</span>`</span>);
});

server.on(<span class="hljs-string">&apos;listening&apos;</span>, () =&gt; {
  <span class="hljs-keyword">var</span> address = server.address();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`server listening <span class="hljs-subst">${address.address}</span>:<span class="hljs-subst">${address.port}</span>`</span>);
});

server.bind(<span class="hljs-number">41234</span>);
<span class="hljs-comment">// server listening 0.0.0.0:41234</span>
</code></pre>
<h3 id="socketbindoptions-callback">socket.bind(options[, callback])</h3>
<ul>
<li><code>options</code> {Object} - Required. Supports the following properties:<ul>
<li><code>port</code> {Number} - Required.</li>
<li><code>address</code> {String} - Optional.</li>
<li><code>exclusive</code> {Boolean} - Optional.</li>
</ul>
</li>
<li><code>callback</code> {Function} - Optional.</li>
</ul>
<p>For UDP sockets, causes the <code>dgram.Socket</code> to listen for datagram messages on a
named <code>port</code> and optional <code>address</code> that are passed as properties of an
<code>options</code> object passed as the first argument. If <code>port</code> is not specified, the
operating system will attempt to bind to a random port. If <code>address</code> is not
specified, the operating system will attempt to listen on all addresses.  Once
binding is complete, a <code>&apos;listening&apos;</code> event is emitted and the optional
<code>callback</code> function is called.</p>
<p>The <code>options</code> object may contain an additional <code>exclusive</code> property that is
use when using <code>dgram.Socket</code> objects with the [<code>cluster</code>] module. When
<code>exclusive</code> is set to <code>false</code> (the default), cluster workers will use the same
underlying socket handle allowing connection handling duties to be shared.
When <code>exclusive</code> is <code>true</code>, however, the handle is not shared and attempted
port sharing results in an error.</p>
<p>An example socket listening on an exclusive port is shown below.</p>
<pre><code class="lang-js">socket.bind({
  address: <span class="hljs-string">&apos;localhost&apos;</span>,
  port: <span class="hljs-number">8000</span>,
  exclusive: <span class="hljs-literal">true</span>
});
</code></pre>
<h3 id="socketclosecallback">socket.close([callback])</h3>
<p>Close the underlying socket and stop listening for data on it. If a callback is
provided, it is added as a listener for the <a href="#dgram_event_close"><code>&apos;close&apos;</code></a> event.</p>
<h3 id="socketdropmembershipmulticastaddress-multicastinterface">socket.dropMembership(multicastAddress[, multicastInterface])</h3>
<!-- YAML
added: v0.6.9
-->
<ul>
<li><code>multicastAddress</code> {String}</li>
<li><code>multicastInterface</code> {String}, Optional</li>
</ul>
<p>Instructs the kernel to leave a multicast group at <code>multicastAddress</code> using the
<code>IP_DROP_MEMBERSHIP</code> socket option. This method is automatically called by the
kernel when the socket is closed or the process terminates, so most apps will
never have reason to call this.</p>
<p>If <code>multicastInterface</code> is not specified, the operating system will attempt to
drop membership on all valid interfaces.</p>
<h3 id="socketsendmsg-offset-length-port-address-callback">socket.send(msg, [offset, length,] port, address[, callback])</h3>
<ul>
<li><code>msg</code> {Buffer|String|Array} Message to be sent</li>
<li><code>offset</code> {Number} Integer. Optional. Offset in the buffer where the message starts.</li>
<li><code>length</code> {Number} Integer. Optional. Number of bytes in the message.</li>
<li><code>port</code> {Number} Integer. Destination port.</li>
<li><code>address</code> {String} Destination hostname or IP address.</li>
<li><code>callback</code> {Function} Called when the message has been sent. Optional.</li>
</ul>
<p>Broadcasts a datagram on the socket. The destination <code>port</code> and <code>address</code> must
be specified.</p>
<p>The <code>msg</code> argument contains the message to be sent.
Depending on its type, different behavior can apply. If <code>msg</code> is a <code>Buffer</code>,
the <code>offset</code> and <code>length</code> specify the offset within the <code>Buffer</code> where the
message begins and the number of bytes in the message, respectively.
If <code>msg</code> is a <code>String</code>, then it is automatically converted to a <code>Buffer</code>
with <code>&apos;utf8&apos;</code> encoding. With messages that
contain  multi-byte characters, <code>offset</code> and <code>length</code> will be calculated with
respect to <a href="buffer.html#buffer_class_method_buffer_bytelength_string_encoding">byte length</a> and not the character position.
If <code>msg</code> is an array, <code>offset</code> and <code>length</code> must not be specified.</p>
<p>The <code>address</code> argument is a string. If the value of <code>address</code> is a host name,
DNS will be used to resolve the address of the host. If the <code>address</code> is not
specified or is an empty string, <code>&apos;127.0.0.1&apos;</code> or <code>&apos;::1&apos;</code> will be used instead.</p>
<p>If the socket has not been previously bound with a call to <code>bind</code>, the socket
is assigned a random port number and is bound to the &quot;all interfaces&quot; address
(<code>&apos;0.0.0.0&apos;</code> for <code>udp4</code> sockets, <code>&apos;::0&apos;</code> for <code>udp6</code> sockets.)</p>
<p>An optional <code>callback</code> function  may be specified to as a way of reporting
DNS errors or for determining when it is safe to reuse the <code>buf</code> object.
Note that DNS lookups delay the time to send for at least one tick of the
Node.js event loop.</p>
<p>The only way to know for sure that the datagram has been sent is by using a
<code>callback</code>. If an error occurs and a <code>callback</code> is given, the error will be
passed as the first argument to the <code>callback</code>. If a <code>callback</code> is not given,
the error is emitted as an <code>&apos;error&apos;</code> event on the <code>socket</code> object.</p>
<p>Offset and length are optional, but if you specify one you would need to
specify the other. Also, they are supported only when the first
argument is a <code>Buffer</code>.</p>
<p>Example of sending a UDP packet to a random port on <code>localhost</code>;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> dgram = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;dgram&apos;</span>);
<span class="hljs-keyword">const</span> message = Buffer.from(<span class="hljs-string">&apos;Some bytes&apos;</span>);
<span class="hljs-keyword">const</span> client = dgram.createSocket(<span class="hljs-string">&apos;udp4&apos;</span>);
client.send(message, <span class="hljs-number">41234</span>, <span class="hljs-string">&apos;localhost&apos;</span>, (err) =&gt; {
  client.close();
});
</code></pre>
<p>Example of sending a UDP packet composed of multiple buffers to a random port on <code>localhost</code>;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> dgram = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;dgram&apos;</span>);
<span class="hljs-keyword">const</span> buf1 = Buffer.from(<span class="hljs-string">&apos;Some &apos;</span>);
<span class="hljs-keyword">const</span> buf2 = Buffer.from(<span class="hljs-string">&apos;bytes&apos;</span>);
<span class="hljs-keyword">const</span> client = dgram.createSocket(<span class="hljs-string">&apos;udp4&apos;</span>);
client.send([buf1, buf2], <span class="hljs-number">41234</span>, <span class="hljs-string">&apos;localhost&apos;</span>, (err) =&gt; {
  client.close();
});
</code></pre>
<p>Sending multiple buffers might be faster or slower depending on your
application and operating system: benchmark it. Usually it is faster.</p>
<p><strong>A Note about UDP datagram size</strong></p>
<p>The maximum size of an <code>IPv4/v6</code> datagram depends on the <code>MTU</code>
(<em>Maximum Transmission Unit</em>) and on the <code>Payload Length</code> field size.</p>
<ul>
<li><p>The <code>Payload Length</code> field is <code>16 bits</code> wide, which means that a normal
payload exceed 64K octets <em>including</em> the internet header and data
(65,507 bytes = 65,535 &#x2212; 8 bytes UDP header &#x2212; 20 bytes IP header);
this is generally true for loopback interfaces, but such long datagram
messages are impractical for most hosts and networks.</p>
</li>
<li><p>The <code>MTU</code> is the largest size a given link layer technology can support for
datagram messages. For any link, <code>IPv4</code> mandates a minimum <code>MTU</code> of <code>68</code>
octets, while the recommended <code>MTU</code> for IPv4 is <code>576</code> (typically recommended
as the <code>MTU</code> for dial-up type applications), whether they arrive whole or in
fragments.</p>
<p>For <code>IPv6</code>, the minimum <code>MTU</code> is <code>1280</code> octets, however, the mandatory minimum
fragment reassembly buffer size is <code>1500</code> octets. The value of <code>68</code> octets is
very small, since most current link layer technologies, like Ethernet, have a
minimum <code>MTU</code> of <code>1500</code>.</p>
</li>
</ul>
<p>It is impossible to know in advance the MTU of each link through which
a packet might travel. Sending a datagram greater than the receiver <code>MTU</code> will
not work because the packet will get silently dropped without informing the
source that the data did not reach its intended recipient.</p>
<h3 id="socketsetbroadcastflag">socket.setBroadcast(flag)</h3>
<!-- YAML
added: v0.6.9
-->
<ul>
<li><code>flag</code> {Boolean}</li>
</ul>
<p>Sets or clears the <code>SO_BROADCAST</code> socket option.  When set to <code>true</code>, UDP
packets may be sent to a local interface&apos;s broadcast address.</p>
<h3 id="socketsetmulticastloopbackflag">socket.setMulticastLoopback(flag)</h3>
<ul>
<li><code>flag</code> {Boolean}</li>
</ul>
<p>Sets or clears the <code>IP_MULTICAST_LOOP</code> socket option.  When set to <code>true</code>,
multicast packets will also be received on the local interface.</p>
<h3 id="socketsetmulticastttlttl">socket.setMulticastTTL(ttl)</h3>
<ul>
<li><code>ttl</code> {Number} Integer</li>
</ul>
<p>Sets the <code>IP_MULTICAST_TTL</code> socket option.  While TTL generally stands for
&quot;Time to Live&quot;, in this context it specifies the number of IP hops that a
packet is allowed to travel through, specifically for multicast traffic.  Each
router or gateway that forwards a packet decrements the TTL. If the TTL is
decremented to 0 by a router, it will not be forwarded.</p>
<p>The argument passed to to <code>socket.setMulticastTTL()</code> is a number of hops
between 0 and 255. The default on most systems is <code>1</code> but can vary.</p>
<h3 id="socketsetttlttl">socket.setTTL(ttl)</h3>
<ul>
<li><code>ttl</code> {Number} Integer</li>
</ul>
<p>Sets the <code>IP_TTL</code> socket option. While TTL generally stands for &quot;Time to Live&quot;,
in this context it specifies the number of IP hops that a packet is allowed to
travel through.  Each router or gateway that forwards a packet decrements the
TTL.  If the TTL is decremented to 0 by a router, it will not be forwarded.
Changing TTL values is typically done for network probes or when multicasting.</p>
<p>The argument to <code>socket.setTTL()</code> is a number of hops between 1 and 255.
The default on most systems is 64 but can vary.</p>
<h3 id="socketref">socket.ref()</h3>
<p>By default, binding a socket will cause it to block the Node.js process from
exiting as long as the socket is open. The <code>socket.unref()</code> method can be used
to exclude the socket from the reference counting that keeps the Node.js
process active. The <code>socket.ref()</code> method adds the socket back to the reference
counting and restores the default behavior.</p>
<p>Calling <code>socket.ref()</code> multiples times will have no additional effect.</p>
<p>The <code>socket.ref()</code> method returns a reference to the socket so calls can be
chained.</p>
<h3 id="socketunref">socket.unref()</h3>
<p>By default, binding a socket will cause it to block the Node.js process from
exiting as long as the socket is open. The <code>socket.unref()</code> method can be used
to exclude the socket from the reference counting that keeps the Node.js
process active, allowing the process to exit even if the socket is still
listening.</p>
<p>Calling <code>socket.unref()</code> multiple times will have no addition effect.</p>
<p>The <code>socket.unref()</code> method returns a reference to the socket so calls can be
chained.</p>
<h3 id="change-to-asynchronous-socketbind-behavior">Change to asynchronous <code>socket.bind()</code> behavior</h3>
<p>As of Node.js v0.10, <a href="#dgram_socket_bind_options_callback"><code>dgram.Socket#bind()</code></a> changed to an asynchronous
execution model. Legacy code that assumes synchronous behavior, as in the
following example:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> s = dgram.createSocket(<span class="hljs-string">&apos;udp4&apos;</span>);
s.bind(<span class="hljs-number">1234</span>);
s.addMembership(<span class="hljs-string">&apos;224.0.0.114&apos;</span>);
</code></pre>
<p>Must be changed to pass a callback function to the <a href="#dgram_socket_bind_options_callback"><code>dgram.Socket#bind()</code></a>
function:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> s = dgram.createSocket(<span class="hljs-string">&apos;udp4&apos;</span>);
s.bind(<span class="hljs-number">1234</span>, () =&gt; {
  s.addMembership(<span class="hljs-string">&apos;224.0.0.114&apos;</span>);
});
</code></pre>
<h2 id="dgram-module-functions"><code>dgram</code> module functions</h2>
<h3 id="dgramcreatesocketoptions-callback">dgram.createSocket(options[, callback])</h3>
<ul>
<li><code>options</code> {Object}</li>
<li><code>callback</code> {Function} Attached as a listener to <code>&apos;message&apos;</code> events.</li>
<li>Returns: {dgram.Socket}</li>
</ul>
<p>Creates a <code>dgram.Socket</code> object. The <code>options</code> argument is an object that
should contain a <code>type</code> field of either <code>udp4</code> or <code>udp6</code> and an optional
boolean <code>reuseAddr</code> field.</p>
<p>When <code>reuseAddr</code> is <code>true</code> <a href="#dgram_socket_bind_port_address_callback"><code>socket.bind()</code></a> will reuse the address, even if
another process has already bound a socket on it. <code>reuseAddr</code> defaults to
<code>false</code>. An optional <code>callback</code> function can be passed specified which is added
as a listener for <code>&apos;message&apos;</code> events.</p>
<p>Once the socket is created, calling <a href="#dgram_socket_bind_port_address_callback"><code>socket.bind()</code></a> will instruct the
socket to begin listening for datagram messages. When <code>address</code> and <code>port</code> are
not passed to  <a href="#dgram_socket_bind_port_address_callback"><code>socket.bind()</code></a> the method will bind the socket to the &quot;all
interfaces&quot; address on a random port (it does the right thing for both <code>udp4</code>
and <code>udp6</code> sockets). The bound address and port can be retrieved using
<a href="#dgram_socket_address"><code>socket.address().address</code></a> and <a href="#dgram_socket_address"><code>socket.address().port</code></a>.</p>
<h3 id="dgramcreatesockettype-callback">dgram.createSocket(type[, callback])</h3>
<ul>
<li><code>type</code> {String} - Either &apos;udp4&apos; or &apos;udp6&apos;</li>
<li><code>callback</code> {Function} - Attached as a listener to <code>&apos;message&apos;</code> events.
Optional</li>
<li>Returns: {dgram.Socket}</li>
</ul>
<p>Creates a <code>dgram.Socket</code> object of the specified <code>type</code>. The <code>type</code> argument
can be either <code>udp4</code> or <code>udp6</code>. An optional <code>callback</code> function can be passed
which is added as a listener for <code>&apos;message&apos;</code> events.</p>
<p>Once the socket is created, calling <a href="#dgram_socket_bind_port_address_callback"><code>socket.bind()</code></a> will instruct the
socket to begin listening for datagram messages. When <code>address</code> and <code>port</code> are
not passed to  <a href="#dgram_socket_bind_port_address_callback"><code>socket.bind()</code></a> the method will bind the socket to the &quot;all
interfaces&quot; address on a random port (it does the right thing for both <code>udp4</code>
and <code>udp6</code> sockets). The bound address and port can be retrieved using
<a href="#dgram_socket_address"><code>socket.address().address</code></a> and <a href="#dgram_socket_address"><code>socket.address().port</code></a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="tty.html" class="navigation navigation-prev " aria-label="Previous page: TTY">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="url.html" class="navigation navigation-next " aria-label="Next page: URL">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"UDP/Datagram","level":"1.35","depth":1,"next":{"title":"URL","level":"1.36","depth":1,"path":"url.md","ref":"url.md","articles":[]},"previous":{"title":"TTY","level":"1.34","depth":1,"path":"tty.md","ref":"tty.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-fontsettings","-search-pro","-advanced-emoji","-github","-splitter","-toggle-chapters"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"search-pro":{"cutWordLib":"nodejieba","defineWord":["Gitbook"]},"github":{"url":"https://github.com/laomu1988/fe-books"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"laomu1988@qq.com","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"fe-books","language":"zh-hans","gitbook":"*"},"file":{"path":"dgram.md","mtime":"2016-08-09T15:23:10.000Z","type":"markdown"},"gitbook":{"version":"3.1.0","time":"2016-08-09T16:10:27.131Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

<script>
	// 百度统计
	var _hmt = _hmt || [];
	(function () {
		var hm = document.createElement("script");
		hm.src = "//hm.baidu.com/hm.js?171566b3d4f03c9c68c8f2c7a42d4b0e";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	})();
</script>
<script src="/fe-books/server/index.js"></script>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    

    </body>
</html>

