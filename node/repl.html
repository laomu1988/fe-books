
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <title>REPL · fe-books</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.0">
        <meta name="author" content="laomu1988@qq.com">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
        

    

    
        
    

        

    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="stream.html" />
    
    
    <link rel="prev" href="readline.html" />
    

<link rel="stylesheet" href="/fe-books/server/index.css"/>

    </head>
    <body>
        
<script src="/fe-books/server/vue.min.js"></script>
<nav class="fe-menu">
	<ul>
		<li><a href="/fe-books/assist/index.html">说明</a></li>
		<li><a href="/fe-books/react/index.html">react</a></li>
		<li>
			<a href="/fe-books/vue/index.html">vue.js</a>
			<ul class="sub">
				<li><a href="/fe-books/vue-router/index.html">vue-router</a></li>
			</ul>
		</li>
		<li>
			<a href="/fe-books/node/documentation.html">node</a>
			<ul class="sub">
				<li><a href="/fe-books/koa/index.html">koa</a></li>
			</ul>
		</li>
		<li><a href="/fe-books/es6/index.html">es6入门</a></li>
		<li>
			<a href="/fe-books/tools/index.html">工具</a>
			<ul class="sub">
				<li><a href="/fe-books/tools/git.html">git</a></li>
				<li><a href="/fe-books/tools/vim.html">vim</a></li>
				<li><a href="/fe-books/fis3/index.html">fis3</a></li>
			</ul>
		</li>
		<li class="menu-last"></li>
	</ul>
</nav>

<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="documentation.html">
            
                <a href="documentation.html">
            
                    
                    About these Docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="synopsis.html">
            
                <a href="synopsis.html">
            
                    
                    Usage & Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="assert.html">
            
                <a href="assert.html">
            
                    
                    Assertion Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="buffer.html">
            
                <a href="buffer.html">
            
                    
                    Buffer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="addons.html">
            
                <a href="addons.html">
            
                    
                    C/C++ Addons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="child_process.html">
            
                <a href="child_process.html">
            
                    
                    Child Processes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="cluster.html">
            
                <a href="cluster.html">
            
                    
                    Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="cli.html">
            
                <a href="cli.html">
            
                    
                    Command Line Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="console.html">
            
                <a href="console.html">
            
                    
                    Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="crypto.html">
            
                <a href="crypto.html">
            
                    
                    Crypto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="debugger.html">
            
                <a href="debugger.html">
            
                    
                    Debugger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="dns.html">
            
                <a href="dns.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="domain.html">
            
                <a href="domain.html">
            
                    
                    Domain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="errors.html">
            
                <a href="errors.html">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="fs.html">
            
                <a href="fs.html">
            
                    
                    File System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="globals.html">
            
                <a href="globals.html">
            
                    
                    Globals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="http.html">
            
                <a href="http.html">
            
                    
                    HTTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="https.html">
            
                <a href="https.html">
            
                    
                    HTTPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="modules.html">
            
                <a href="modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="net.html">
            
                <a href="net.html">
            
                    
                    Net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="os.html">
            
                <a href="os.html">
            
                    
                    OS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="path.html">
            
                <a href="path.html">
            
                    
                    Path
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25" data-path="process.html">
            
                <a href="process.html">
            
                    
                    Process
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26" data-path="punycode.html">
            
                <a href="punycode.html">
            
                    
                    Punycode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27" data-path="querystring.html">
            
                <a href="querystring.html">
            
                    
                    Query Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28" data-path="readline.html">
            
                <a href="readline.html">
            
                    
                    Readline
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.29" data-path="repl.html">
            
                <a href="repl.html">
            
                    
                    REPL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30" data-path="stream.html">
            
                <a href="stream.html">
            
                    
                    Stream
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.31" data-path="string_decoder.html">
            
                <a href="string_decoder.html">
            
                    
                    String Decoder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.32" data-path="timers.html">
            
                <a href="timers.html">
            
                    
                    Timers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33" data-path="tls.html">
            
                <a href="tls.html">
            
                    
                    TLS/SSL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34" data-path="tty.html">
            
                <a href="tty.html">
            
                    
                    TTY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35" data-path="dgram.html">
            
                <a href="dgram.html">
            
                    
                    UDP/Datagram
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.36" data-path="url.html">
            
                <a href="url.html">
            
                    
                    URL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37" data-path="util.html">
            
                <a href="util.html">
            
                    
                    Utilities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.38" data-path="v8.html">
            
                <a href="v8.html">
            
                    
                    V8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.39" data-path="vm.html">
            
                <a href="vm.html">
            
                    
                    VM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.40" data-path="zlib.html">
            
                <a href="zlib.html">
            
                    
                    ZLIB
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://github.com/nodejs/node">
            
                    
                    GitHub Repo & Issue Tracker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <a target="_blank" href="http://groups.google.com/group/nodejs">
            
                    
                    Mailing List
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >REPL</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="repl">REPL</h1>
<pre><code>Stability: 2 - Stable
</code></pre><p>The <code>repl</code> module provides a Read-Eval-Print-Loop (REPL) implementation that
is available both as a standalone program or includable in other applications.
It can be accessed using:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);
</code></pre>
<h2 id="design-and-features">Design and Features</h2>
<p>The <code>repl</code> module exports the <code>repl.REPLServer</code> class. While running, instances
of <code>repl.REPLServer</code> will accept individual lines of user input, evaluate those
according to a user-defined evaluation function, then output the result. Input
and output may be from <code>stdin</code> and <code>stdout</code>, respectively, or may be connected
to any Node.js <a href="stream.html">stream</a>.</p>
<p>Instances of <code>repl.REPLServer</code> support automatic completion of inputs,
simplistic Emacs-style line editing, multi-line inputs, ANSI-styled output,
saving and restoring current REPL session state, error recovery, and
customizable evaluation functions.</p>
<h3 id="commands-and-special-keys">Commands and Special Keys</h3>
<p>The following special commands are supported by all REPL instances:</p>
<ul>
<li><code>.break</code> - When in the process of inputting a multi-line expression, entering
the <code>.break</code> command (or pressing the <code>&lt;ctrl&gt;-C</code> key combination) will abort
further input or processing of that expression.</li>
<li><code>.clear</code> - Resets the REPL <code>context</code> to an empty object and clears any
multi-line expression currently being input.</li>
<li><code>.exit</code> - Close the I/O stream, causing the REPL to exit.</li>
<li><code>.help</code> - Show this list of special commands.</li>
<li><code>.save</code> - Save the current REPL session to a file:
<code>&gt; .save ./file/to/save.js</code></li>
<li><code>.load</code> - Load a file into the current REPL session.
<code>&gt; .load ./file/to/load.js</code></li>
</ul>
<p>The following key combinations in the REPL have these special effects:</p>
<ul>
<li><code>&lt;ctrl&gt;-C</code> - When pressed once, has the same effect as the <code>.break</code> command.
When pressed twice on a blank line, has the same effect as the <code>.exit</code>
command.</li>
<li><code>&lt;ctrl&gt;-D</code> - Has the same effect as the <code>.exit</code> command.</li>
<li><code>&lt;tab&gt;</code> - When pressed on a blank line, displays global and local(scope)
variables. When pressed while entering other input, displays relevant
autocompletion options.</li>
</ul>
<h3 id="default-evaluation">Default Evaluation</h3>
<p>By default, all instances of <code>repl.REPLServer</code> use an evaluation function that
evaluates JavaScript expressions and provides access to Node.js&apos; built-in
modules. This default behavior can be overridden by passing in an alternative
evaluation function when the <code>repl.REPLServer</code> instance is created.</p>
<h4 id="javascript-expressions">JavaScript Expressions</h4>
<p>The default evaluator supports direct evaluation of JavaScript expressions:</p>
<pre><code class="lang-js">&gt; <span class="hljs-number">1</span> + <span class="hljs-number">1</span>
<span class="hljs-number">2</span>
&gt; <span class="hljs-keyword">var</span> m = <span class="hljs-number">2</span>
<span class="hljs-literal">undefined</span>
&gt; m + <span class="hljs-number">1</span>
<span class="hljs-number">3</span>
</code></pre>
<p>Unless otherwise scoped within blocks (e.g. <code>{ ... }</code>) or functions, variables
declared either implicitly or using the <code>var</code> keyword are declared at the
<code>global</code> scope.</p>
<h4 id="global-and-local-scope">Global and Local Scope</h4>
<p>The default evaluator provides access to any variables that exist in the global
scope. It is possible to expose a variable to the REPL explicitly by assigning
it to the <code>context</code> object associated with each <code>REPLServer</code>.  For example:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);
<span class="hljs-keyword">var</span> msg = <span class="hljs-string">&apos;message&apos;</span>;

repl.start(<span class="hljs-string">&apos;&gt; &apos;</span>).context.m = msg;
</code></pre>
<p>Properties in the <code>context</code> object appear as local within the REPL:</p>
<pre><code class="lang-js">$ node repl_test.js
&gt; m
<span class="hljs-string">&apos;message&apos;</span>
</code></pre>
<p>It is important to note that context properties are <em>not</em> read-only by default.
To specify read-only globals, context properties must be defined using
<code>Object.defineProperty()</code>:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);
<span class="hljs-keyword">var</span> msg = <span class="hljs-string">&apos;message&apos;</span>;

<span class="hljs-keyword">const</span> r = repl.start(<span class="hljs-string">&apos;&gt; &apos;</span>);
<span class="hljs-built_in">Object</span>.defineProperty(r, <span class="hljs-string">&apos;m&apos;</span>, {
  configurable: <span class="hljs-literal">false</span>,
  enumerable: <span class="hljs-literal">true</span>,
  value: msg
});
</code></pre>
<h4 id="accessing-core-nodejs-modules">Accessing Core Node.js Modules</h4>
<p>The default evaluator will automatically load Node.js core modules into the
REPL environment when used. For instance, unless otherwise declared as a
global or scoped variable, the input <code>fs</code> will be evaluated on-demand as
<code>global.fs = require(&apos;fs&apos;)</code>.</p>
<pre><code class="lang-js">&gt; fs.createReadStream(<span class="hljs-string">&apos;./some/file&apos;</span>);
</code></pre>
<h4 id="assignment-of-the--underscore-variable">Assignment of the <code>_</code> (underscore) variable</h4>
<p>The default evaluator will, by default, assign the result of the most recently
evaluated expression to the special variable <code>_</code> (underscore).</p>
<pre><code class="lang-js">&gt; [ <span class="hljs-string">&apos;a&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>, <span class="hljs-string">&apos;c&apos;</span> ]
[ <span class="hljs-string">&apos;a&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>, <span class="hljs-string">&apos;c&apos;</span> ]
&gt; _.length
<span class="hljs-number">3</span>
&gt; _ += <span class="hljs-number">1</span>
<span class="hljs-number">4</span>
</code></pre>
<p>Explicitly setting <code>_</code> to a value will disable this behavior.</p>
<h3 id="custom-evaluation-functions">Custom Evaluation Functions</h3>
<p>When a new <code>repl.REPLServer</code> is created, a custom evaluation function may be
provided. This can be used, for instance, to implement fully customized REPL
applications.</p>
<p>The following illustrates a hypothetical example of a REPL that performs
translation of text from one language to another:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);
<span class="hljs-keyword">const</span> Translator = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;translator&apos;</span>).Translator;

<span class="hljs-keyword">const</span> myTranslator = <span class="hljs-keyword">new</span> Translator(<span class="hljs-string">&apos;en&apos;</span>, <span class="hljs-string">&apos;fr&apos;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myEval</span>(<span class="hljs-params">cmd, context, filename, callback</span>) </span>{
  callback(<span class="hljs-literal">null</span>, myTranslator.translate(cmd));
}

repl.start({prompt: <span class="hljs-string">&apos;&gt; &apos;</span>, <span class="hljs-built_in">eval</span>: myEval});
</code></pre>
<h4 id="recoverable-errors">Recoverable Errors</h4>
<p>As a user is typing input into the REPL prompt, pressing the <code>&lt;enter&gt;</code> key will
send the current line of input to the <code>eval</code> function. In order to support
multi-line input, the eval function can return an instance of <code>repl.Recoverable</code>
to the provided callback function:</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eval</span>(<span class="hljs-params">cmd, context, filename, callback</span>) </span>{
  <span class="hljs-keyword">var</span> result;
  <span class="hljs-keyword">try</span> {
    result = vm.runInThisContext(cmd);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">if</span> (isRecoverableError(e)) {
      <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> repl.Recoverable(e));
    }
  }
  callback(<span class="hljs-literal">null</span>, result);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isRecoverableError</span>(<span class="hljs-params">error</span>) </span>{
  <span class="hljs-keyword">if</span> (error.name === <span class="hljs-string">&apos;SyntaxError&apos;</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^(Unexpected end of input|Unexpected token)/</span>.test(error.message);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 id="customizing-repl-output">Customizing REPL Output</h3>
<p>By default, <code>repl.REPLServer</code> instances format output using the
<a href="util.html#util_util_inspect_object_options"><code>util.inspect()</code></a> method before writing the output to the provided Writable
stream (<code>process.stdout</code> by default). The <code>useColors</code> boolean option can be
specified at construction to instruct the default writer to use ANSI style
codes to colorize the output from the <code>util.inspect()</code> method.</p>
<p>It is possible to fully customize the output of a <code>repl.REPLServer</code> instance
by passing a new function in using the <code>writer</code> option on construction. The
following example, for instance, simply converts any input text to upper case:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);

<span class="hljs-keyword">const</span> r = repl.start({prompt: <span class="hljs-string">&apos;&gt;&apos;</span>, <span class="hljs-built_in">eval</span>: myEval, writer: myWriter});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myEval</span>(<span class="hljs-params">cmd, context, filename, callback</span>) </span>{
  callback(<span class="hljs-literal">null</span>,cmd);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myWriter</span>(<span class="hljs-params">output</span>) </span>{
  <span class="hljs-keyword">return</span> output.toUpperCase();
}
</code></pre>
<h2 id="class-replserver">Class: REPLServer</h2>
<!-- YAML
added: v0.1.91
-->
<p>The <code>repl.REPLServer</code> class inherits from the <a href="readline.html#readline_class_interface"><code>readline.Interface</code></a> class.
Instances of <code>repl.REPLServer</code> are created using the <code>repl.start()</code> method and
<em>should not</em> be created directly using the JavaScript <code>new</code> keyword.</p>
<h3 id="event-exit">Event: &apos;exit&apos;</h3>
<!-- YAML
added: v0.7.7
-->
<p>The <code>&apos;exit&apos;</code> event is emitted when the REPL is exited either by receiving the
<code>.exit</code> command as input, the user pressing <code>&lt;ctrl&gt;-C</code> twice to signal <code>SIGINT</code>,
or by pressing <code>&lt;ctrl&gt;-D</code> to signal <code>&apos;end&apos;</code> on the input stream. The listener
callback is invoked without any arguments.</p>
<pre><code class="lang-js">replServer.on(<span class="hljs-string">&apos;exit&apos;</span>, () =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Received &quot;exit&quot; event from repl!&apos;</span>);
  process.exit();
});
</code></pre>
<h3 id="event-reset">Event: &apos;reset&apos;</h3>
<!-- YAML
added: v0.11.0
-->
<p>The <code>&apos;reset&apos;</code> event is emitted when the REPL&apos;s context is reset. This occurs
whenever the <code>.clear</code> command is received as input <em>unless</em> the REPL is using
the default evaluator and the <code>repl.REPLServer</code> instance was created with the
<code>useGlobal</code> option set to <code>true</code>. The listener callback will be called with a
reference to the <code>context</code> object as the only argument.</p>
<p>This can be used primarily to re-initialize REPL context to some pre-defined
state as illustrated in the following simple example:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeContext</span>(<span class="hljs-params">context</span>) </span>{
  context.m = <span class="hljs-string">&apos;test&apos;</span>;
}

<span class="hljs-keyword">var</span> r = repl.start({prompt: <span class="hljs-string">&apos;&gt;&apos;</span>});
initializeContext(r.context);

r.on(<span class="hljs-string">&apos;reset&apos;</span>, initializeContext);
</code></pre>
<p>When this code is executed, the global <code>&apos;m&apos;</code> variable can be modified but then
reset to its initial value using the <code>.clear</code> command:</p>
<pre><code class="lang-js">$ ./node example.js
&gt;m
<span class="hljs-string">&apos;test&apos;</span>
&gt;m = <span class="hljs-number">1</span>
<span class="hljs-number">1</span>
&gt;m
<span class="hljs-number">1</span>
&gt;.clear
Clearing context...
&gt;m
<span class="hljs-string">&apos;test&apos;</span>
&gt;
</code></pre>
<h3 id="replserverdefinecommandkeyword-cmd">replServer.defineCommand(keyword, cmd)</h3>
<!-- YAML
added: v0.3.0
-->
<ul>
<li><code>keyword</code> {String} The command keyword (<em>without</em> a leading <code>.</code> character).</li>
<li><code>cmd</code> {Object|Function} The function to invoke when the command is processed.</li>
</ul>
<p>The <code>replServer.defineCommand()</code> method is used to add new <code>.</code>-prefixed commands
to the REPL instance. Such commands are invoked by typing a <code>.</code> followed by the
<code>keyword</code>. The <code>cmd</code> is either a Function or an object with the following
properties:</p>
<ul>
<li><code>help</code> {String} Help text to be displayed when <code>.help</code> is entered (Optional).</li>
<li><code>action</code> {Function} The function to execute, optionally accepting a single
string argument.</li>
</ul>
<p>The following example shows two new commands added to the REPL instance:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);

<span class="hljs-keyword">var</span> replServer = repl.start({prompt: <span class="hljs-string">&apos;&gt; &apos;</span>});
replServer.defineCommand(<span class="hljs-string">&apos;sayhello&apos;</span>, {
  help: <span class="hljs-string">&apos;Say hello&apos;</span>,
  action: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">this</span>.lineParser.reset();
    <span class="hljs-keyword">this</span>.bufferedCommand = <span class="hljs-string">&apos;&apos;</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Hello, <span class="hljs-subst">${name}</span>!`</span>);
    <span class="hljs-keyword">this</span>.displayPrompt();
  }
});
replServer.defineCommand(<span class="hljs-string">&apos;saybye&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Goodbye!&apos;</span>);
  <span class="hljs-keyword">this</span>.close();
});
</code></pre>
<p>The new commands can then be used from within the REPL instance:</p>
<pre><code class="lang-txt">&gt; .sayhello Node.js User
Hello, Node.js User!
&gt; .saybye
Goodbye!
</code></pre>
<h3 id="replserverdisplaypromptpreservecursor">replServer.displayPrompt([preserveCursor])</h3>
<!-- YAML
added: v0.1.91
-->
<ul>
<li><code>preserveCursor</code> {Boolean}</li>
</ul>
<p>The <code>replServer.displayPrompt()</code> method readies the REPL instance for input
from the user, printing the configured <code>prompt</code> to a new line in the <code>output</code>
and resuming the <code>input</code> to accept new input.</p>
<p>When multi-line input is being entered, an ellipsis is printed rather than the
&apos;prompt&apos;.</p>
<p>When <code>preserveCursor</code> is <code>true</code>, the cursor placement will not be reset to <code>0</code>.</p>
<p>The <code>replServer.displayPrompt</code> method is primarily intended to be called from
within the action function for commands registered using the
<code>replServer.defineCommand()</code> method.</p>
<h2 id="replstartoptions">repl.start([options])</h2>
<!-- YAML
added: v0.1.91
-->
<ul>
<li><code>options</code> {Object}<ul>
<li><code>prompt</code> {String} The input prompt to display. Defaults to <code>&gt;</code>.</li>
<li><code>input</code> {Readable} The Readable stream from which REPL input will be read.
Defaults to <code>process.stdin</code>.</li>
<li><code>output</code> {Writable} The Writable stream to which REPL output will be
written. Defaults to <code>process.stdout</code>.</li>
<li><code>terminal</code> {boolean} If <code>true</code>, specifies that the <code>output</code> should be
treated as a a TTY terminal, and have ANSI/VT100 escape codes written to it.
Defaults to checking the value of the <code>isTTY</code> property on the <code>output</code>
stream upon instantiation.</li>
<li><code>eval</code> {Function} The function to be used when evaluating each given line
of input. Defaults to an async wrapper for the JavaScript <code>eval()</code>
function.  An <code>eval</code> function can error with <code>repl.Recoverable</code> to indicate
the input was incomplete and prompt for additional lines.</li>
<li><code>useColors</code> {boolean} If <code>true</code>, specifies that the default <code>writer</code>
function should include ANSI color styling to REPL output. If a custom
<code>writer</code> function is provided then this has no effect. Defaults to the
 REPL instances <code>terminal</code> value.</li>
<li><code>useGlobal</code> {boolean} If <code>true</code>, specifies that the default evaluation
 function will use the JavaScript <code>global</code> as the context as opposed to
 creating a new separate context for the REPL instance. Defaults to <code>false</code>.</li>
<li><code>ignoreUndefined</code> {boolean} If <code>true</code>, specifies that the default writer
 will not output the return value of a command if it evaluates to
 <code>undefined</code>. Defaults to <code>false</code>.</li>
<li><code>writer</code> {Function} The function to invoke to format the output of each
 command before writing to <code>output</code>. Defaults to <a href="util.html#util_util_inspect_object_options"><code>util.inspect()</code></a>.</li>
<li><code>completer</code> {Function} An optional function used for custom Tab auto
 completion. See <a href="readline.html#readline_use_of_the_completer_function"><code>readline.InterfaceCompleter</code></a> for an example.</li>
<li><code>replMode</code> - A flag that specifies whether the default evaluator executes
all JavaScript commands in strict mode, default mode, or a hybrid mode
(&quot;magic&quot; mode.) Acceptable values are:<ul>
<li><code>repl.REPL_MODE_SLOPPY</code> - evaluates expressions in sloppy mode.</li>
<li><code>repl.REPL_MODE_STRICT</code> - evaluates expressions in strict mode. This is
equivalent to prefacing every repl statement with <code>&apos;use strict&apos;</code>.</li>
<li><code>repl.REPL_MODE_MAGIC</code> - attempt to evaluates expressions in default
mode.  If expressions fail to parse, re-try in strict mode.</li>
</ul>
</li>
<li><code>breakEvalOnSigint</code> - Stop evaluating the current piece of code when
<code>SIGINT</code> is received, i.e. <code>Ctrl+C</code> is pressed. This cannot be used together
with a custom <code>eval</code> function. Defaults to <code>false</code>.</li>
</ul>
</li>
</ul>
<p>The <code>repl.start()</code> method creates and starts a <code>repl.REPLServer</code> instance.</p>
<h2 id="the-nodejs-repl">The Node.js REPL</h2>
<p>Node.js itself uses the <code>repl</code> module to provide its own interactive interface
for executing JavaScript. This can used by executing the Node.js binary without
passing any arguments (or by passing the <code>-i</code> argument):</p>
<pre><code class="lang-js">$ node
&gt; a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
[ <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> ]
&gt; a.forEach((v) =&gt; {
...   console.log(v);
...   });
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
</code></pre>
<h3 id="environment-variable-options">Environment Variable Options</h3>
<p>Various behaviors of the Node.js REPL can be customized using the following
environment variables:</p>
<ul>
<li><code>NODE_REPL_HISTORY</code> - When a valid path is given, persistent REPL history
will be saved to the specified file rather than <code>.node_repl_history</code> in the
user&apos;s home directory. Setting this value to <code>&quot;&quot;</code> will disable persistent
REPL history. Whitespace will be trimmed from the value.</li>
<li><code>NODE_REPL_HISTORY_SIZE</code> - Defaults to <code>1000</code>. Controls how many lines of
history will be persisted if history is available. Must be a positive number.</li>
<li><code>NODE_REPL_MODE</code> - May be any of <code>sloppy</code>, <code>strict</code>, or <code>magic</code>. Defaults
to <code>magic</code>, which will automatically run &quot;strict mode only&quot; statements in
strict mode.</li>
</ul>
<h3 id="persistent-history">Persistent History</h3>
<p>By default, the Node.js REPL will persist history between <code>node</code> REPL sessions
by saving inputs to a <code>.node_repl_history</code> file located in the user&apos;s home
directory. This can be disabled by setting the environment variable
<code>NODE_REPL_HISTORY=&quot;&quot;</code>.</p>
<h4 id="nodereplhistoryfile">NODE_REPL_HISTORY_FILE</h4>
<!-- YAML
added: v2.0.0
deprecated: v3.0.0
-->
<p>   Stability: 0 - Deprecated: Use <code>NODE_REPL_HISTORY</code> instead.</p>
<p>Previously in Node.js/io.js v2.x, REPL history was controlled by using a
<code>NODE_REPL_HISTORY_FILE</code> environment variable, and the history was saved in JSON
format. This variable has now been deprecated, and the old JSON REPL history
file will be automatically converted to a simplified plain text format. This new
file will be saved to either the user&apos;s home directory, or a directory defined
by the <code>NODE_REPL_HISTORY</code> variable, as documented in the
<a href="#repl_environment_variable_options">Environment Variable Options</a>.</p>
<h3 id="using-the-nodejs-repl-with-advanced-line-editors">Using the Node.js REPL with advanced line-editors</h3>
<p>For advanced line-editors, start Node.js with the environmental variable
<code>NODE_NO_READLINE=1</code>. This will start the main and debugger REPL in canonical
terminal settings which will allow you to use with <code>rlwrap</code>.</p>
<p>For example, you could add this to your bashrc file:</p>
<pre><code class="lang-text">alias node=&quot;env NODE_NO_READLINE=1 rlwrap node&quot;
</code></pre>
<h3 id="starting-multiple-repl-instances-against-a-single-running-instance">Starting multiple REPL instances against a single running instance</h3>
<p>It is possible to create and run multiple REPL instances against a single
running instance of Node.js that share a single <code>global</code> object but have
separate I/O interfaces.</p>
<p>The following example, for instance, provides separate REPLs on <code>stdin</code>, a Unix
socket, and a TCP socket:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;net&apos;</span>);
<span class="hljs-keyword">const</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;repl&apos;</span>);
<span class="hljs-keyword">var</span> connections = <span class="hljs-number">0</span>;

repl.start({
  prompt: <span class="hljs-string">&apos;Node.js via stdin&gt; &apos;</span>,
  input: process.stdin,
  output: process.stdout
});

net.createServer((socket) =&gt; {
  connections += <span class="hljs-number">1</span>;
  repl.start({
    prompt: <span class="hljs-string">&apos;Node.js via Unix socket&gt; &apos;</span>,
    input: socket,
    output: socket
  }).on(<span class="hljs-string">&apos;exit&apos;</span>, () =&gt; {
    socket.end();
  });
}).listen(<span class="hljs-string">&apos;/tmp/node-repl-sock&apos;</span>);

net.createServer((socket) =&gt; {
  connections += <span class="hljs-number">1</span>;
  repl.start({
    prompt: <span class="hljs-string">&apos;Node.js via TCP socket&gt; &apos;</span>,
    input: socket,
    output: socket
  }).on(<span class="hljs-string">&apos;exit&apos;</span>, () =&gt; {
    socket.end();
  });
}).listen(<span class="hljs-number">5001</span>);
</code></pre>
<p>Running this application from the command line will start a REPL on stdin.
Other REPL clients may connect through the Unix socket or TCP socket. <code>telnet</code>,
for instance, is useful for connecting to TCP sockets, while <code>socat</code> can be used
to connect to both Unix and TCP sockets.</p>
<p>By starting a REPL from a Unix socket-based server instead of stdin, it is
possible to connect to a long-running Node.js process without restarting it.</p>
<p>For an example of running a &quot;full-featured&quot; (<code>terminal</code>) REPL over
a <code>net.Server</code> and <code>net.Socket</code> instance, see: <a href="https://gist.github.com/2209310" _target="blank">https://gist.github.com/2209310</a></p>
<p>For an example of running a REPL instance over <code>curl(1)</code>,
see: <a href="https://gist.github.com/2053342" _target="blank">https://gist.github.com/2053342</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="readline.html" class="navigation navigation-prev " aria-label="Previous page: Readline">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="stream.html" class="navigation navigation-next " aria-label="Next page: Stream">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"REPL","level":"1.29","depth":1,"next":{"title":"Stream","level":"1.30","depth":1,"path":"stream.md","ref":"stream.md","articles":[]},"previous":{"title":"Readline","level":"1.28","depth":1,"path":"readline.md","ref":"readline.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-fontsettings","-search-pro","-advanced-emoji","-github","-splitter","-toggle-chapters"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"search-pro":{"cutWordLib":"nodejieba","defineWord":["Gitbook"]},"github":{"url":"https://github.com/laomu1988/fe-books"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"laomu1988@qq.com","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"fe-books","language":"zh-hans","gitbook":"*"},"file":{"path":"repl.md","mtime":"2017-02-07T11:13:21.000Z","type":"markdown"},"gitbook":{"version":"3.1.0","time":"2017-02-07T12:00:32.272Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

<script>
	// 百度统计
	var _hmt = _hmt || [];
	(function () {
		var hm = document.createElement("script");
		hm.src = "//hm.baidu.com/hm.js?171566b3d4f03c9c68c8f2c7a42d4b0e";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	})();
</script>
<script src="/fe-books/server/index.js"></script>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    

    </body>
</html>

